---
title: "scratchpad"
author: "Ethan Horn, David Lopez"
date: "2023-11-17"
output: word_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
set.seed(19)
```

```{r load_data, message=FALSE}
# global.lt.city      <- read_csv('datasets/GlobalLandTemperaturesByCity.csv')
# global.lt.country   <- read_csv('datasets/GlobalLandTemperaturesByCountry.csv')
# global.lt.majorcity <- read_csv('datasets/GlobalLandTemperaturesByMajorCity.csv')
# global.lt.state     <- read_csv('datasets/GlobalLandTemperaturesByState.csv')
# global.temps        <- read_csv('datasets/GlobalTemperatures.csv')
hri.emer.raw          <- jsonlite::fromJSON('datasets/hri_emergencyvisits.json')
hri.hosp.raw          <- jsonlite::fromJSON('datasets/hri_hospitalization.json')
hri.mort.raw          <- jsonlite::fromJSON('datasets/hri_mortality.json')

co2.raw               <- read_csv('datasets/Atmospheric_CO2_Concentrations.csv')
```
```{r tidy_data}
hri.emer <- hri.emer.raw$tableResult %>%
  filter(hatchingId == -1) %>%  # Filter out "Unstable" points of data
  select(geo, geoId, year, dataValue) %>%
  rename(state           = geo,
         state.id        = geoId,
         emer.per.capita = dataValue) %>%
  mutate(state.id        = as.numeric(state.id),
         year            = as.numeric(year),
         emer.per.capita = as.numeric(emer.per.capita))

hri.hosp <- hri.hosp.raw$tableResult %>%
  filter(hatchingId == -1) %>%  # Filter out "Unstable" points of data
  select(geo, geoId, year, dataValue) %>%
  rename(state           = geo,
         state.id        = geoId,
         hosp.per.capita = dataValue) %>%
  mutate(state.id        = as.numeric(state.id),
         year            = as.numeric(year),
         hosp.per.capita = as.numeric(hosp.per.capita))

hri.mort <- hri.mort.raw$tableResult %>%
  filter(suppressionFlag == 0) %>% # Filter out "Suppressed" points of data
  select(geo, geoId, year, dataValue) %>%
  rename(state             = geo,
         state.id          = geoId,
         mortalities.total = dataValue) %>%
  mutate(state.id          = as.numeric(state.id),
         year              = as.numeric(year),
         mortalities.total = as.numeric(mortalities.total))

co2 <- co2.raw %>%
  filter(Unit == "Parts Per Million") %>%
  select(Date, Value) %>%
  rename(date = Date,
         ppm  = Value) %>%
  mutate(date = str_replace(date, "M", "-"),
         date = paste0(date, '-01'),
         date = as.Date(date)) %>%
  filter(date >= as.Date("2000-01-01"))

# temps <- global.lt.state %>%
#         filter(Country == "United States") %>%
#         select(dt, AverageTemperature, State) %>%
#         rename(date = dt,
#                avg.temp.celsius = AverageTemperature,
#                state = State) %>%
#         filter(date >= as.Date("2000-01-01"))
```

```{r emer_cor}
hri.emer.model <- lm(emer.per.capita ~ year, data=hri.emer)

ggplot(hri.emer, aes(year, emer.per.capita)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE)

summary(hri.emer.model)
```
```{r hosp_cor}
hri.hosp.model <- lm(hosp.per.capita ~ year, data=hri.hosp)

ggplot(hri.hosp, aes(year, hosp.per.capita)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE)

summary(hri.hosp.model)
```

```{r hosp_cor}
hri.mort.model <- lm(mortalities.total ~ year, data=hri.mort)

ggplot(hri.mort, aes(year, mortalities.total)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE)

summary(hri.mort.model)
```